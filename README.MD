# Iven API Documentation

## üîê Contr√¥leur d'Authentification (`/api/auth`)

### Register
```
POST /api/auth/register
Content-Type: application/json

{
  "username": "testuser",
  "email": "testuser@example.com",
  "password": "password123",
  "fname": "Pr√©nom",
  "lname": "Nom"
}   
```

**R√©ponse :**
```json
{
  "message": "Inscription r√©ussie ! Un code de confirmation √† 6 chiffres a √©t√© envoy√© √† votre email.",
  "userId": 123
}
```

### Confirm Email (Code √† 6 chiffres)
```
POST /api/auth/confirm
Content-Type: application/json

{
  "email": "testuser@example.com",
  "code": "123456"
}
```

**R√©ponse succ√®s :**
```json
{
  "message": "Compte activ√© avec succ√®s",
  "email": "testuser@example.com",
  "token": "jwt_token_here",
  "user": {
    "id": 123,
    "username": "testuser",
    "email": "testuser@example.com",
    "active": 1
  }
}
```

**R√©ponse erreur :**
```json
{
  "message": "Code invalide ou expir√©",
  "error": "Le code de confirmation est incorrect ou a expir√©. Veuillez demander un nouveau code."
}
```

### Resend Confirmation Code
```
POST /api/auth/resend-confirmation-email
Content-Type: application/json

{
  "email": "testuser@example.com"
}
```

**R√©ponse :**
```json
{
  "message": "Nouveau code de confirmation envoy√© par email"
}
```

### Login
```
POST /api/auth/login                                
Content-Type: application/json

{
  "email": "testuser@example.com",
  "password": "password123"
}
```

**R√©ponse succ√®s :**
```json
{
  "message": "Connexion r√©ussie",
  "token": "jwt_token_here",
  "user": {
    "id": 123,
    "username": "testuser",
    "email": "testuser@example.com",
    "active": 1,
    "fname": "Pr√©nom",
    "lname": "Nom"
  }
}
```

**R√©ponse compte non activ√© :**
```json
{
  "message": "Votre compte n'est pas activ√©",
  "code": "not-activated",
  "user": {
    "username": "testuser",
    "fname": "Pr√©nom",
    "lname": "Nom",
    "email": "testuser@example.com",
    "active": 0
  }
}
```

### Forgot Password
```
POST /api/auth/forgot-password
Content-Type: application/json

{
  "email": "testuser@example.com"
}
```

**R√©ponse :**
```json
{
  "message": "Instructions de r√©initialisation envoy√©es par email"
}
```

### Logout
```
POST /api/auth/logout
Authorization: Bearer <token>
```

**R√©ponse :**
```json
{
  "message": "D√©connexion r√©ussie"
}
```

## üìÖ Contr√¥leur d'√âv√©nements (`/api/event`)

### Cr√©er un √©v√©nement
```
POST /api/event/create
Authorization: Bearer <token>
Content-Type: application/json

{
  "title": "Titre de l'√©v√©nement",
  "description": "Description de l'√©v√©nement",
  "start_date": "2024-01-15T10:00:00Z",
  "end_date": "2024-01-15T18:00:00Z",
  "location": "Lieu de l'√©v√©nement",
  "owner_id": 123
}
```

**R√©ponse :**
```json
{
  "id": 1,
  "title": "Titre de l'√©v√©nement",
  "description": "Description de l'√©v√©nement",
  "start_date": "2024-01-15T10:00:00Z",
  "end_date": "2024-01-15T18:00:00Z",
  "location": "Lieu de l'√©v√©nement",
  "owner_id": 123
}
```

### Mettre √† jour un √©v√©nement
```
PUT /api/event/:id
Authorization: Bearer <token>
Content-Type: application/json

{
  "title": "Nouveau titre de l'√©v√©nement",
  "description": "Nouvelle description de l'√©v√©nement",
  "start_date": "2024-01-16T10:00:00Z",
  "end_date": "2024-01-16T18:00:00Z",
  "location": "Nouveau lieu de l'√©v√©nement"
}
```

**R√©ponse :**
```json
{
  "message": "√âv√©nement mis √† jour avec succ√®s",
  "event": {
    "id": 1,
    "title": "Nouveau titre de l'√©v√©nement",
    "description": "Nouvelle description de l'√©v√©nement",
    "start_date": "2024-01-16T10:00:00Z",
    "end_date": "2024-01-16T18:00:00Z",
    "location": "Nouveau lieu de l'√©v√©nement",
    "owner_id": 123,
    "updated_at": "2024-01-15T15:30:00Z"
  }
}
```

**Erreurs possibles :**
```json
{
  "error": "√âv√©nement non trouv√©"
}
```

```json
{
  "error": "Acc√®s non autoris√©. Seul le propri√©taire peut modifier cet √©v√©nement."
}
```

### Supprimer un √©v√©nement
```
DELETE /api/event/:id
Authorization: Bearer <token>
```

**R√©ponse :**
```json
{
  "message": "√âv√©nement supprim√© avec succ√®s",
  "eventId": 1
}
```

**Erreurs possibles :**
```json
{
  "error": "√âv√©nement non trouv√©"
}
```

```json
{
  "error": "Acc√®s non autoris√©. Seul le propri√©taire peut supprimer cet √©v√©nement."
}
```

**‚ö†Ô∏è Attention :** La suppression d'un √©v√©nement supprime √©galement :
- Tous les participants de l'√©v√©nement
- Toutes les t√¢ches associ√©es √† l'√©v√©nement
- Toutes les d√©penses associ√©es √† l'√©v√©nement

### G√©rer les participants d'un √©v√©nement

#### Ajouter un participant
```
POST /api/event/:eventId/participants
Authorization: Bearer <token>
Content-Type: application/json

{
  "userId": 456,
  "role": "participant"
}
```

**R√©ponse :**
```json
{
  "message": "Participant ajout√© avec succ√®s",
  "participant": {
    "event_id": 1,
    "user_id": 456,
    "role": "participant",
    "username": "nouveau_user",
    "email": "nouveau@example.com"
  }
}
```

**Erreurs possibles :**
```json
{
  "error": "Acc√®s non autoris√©. Seul le propri√©taire peut ajouter des participants."
}
```

```json
{
  "error": "Cet utilisateur est d√©j√† participant de cet √©v√©nement"
}
```

#### Retirer un participant
```
DELETE /api/event/:eventId/participants/:userId
Authorization: Bearer <token>
```

**R√©ponse :**
```json
{
  "message": "Participant retir√© avec succ√®s",
  "eventId": 1,
  "userId": 456
}
```

**Erreurs possibles :**
```json
{
  "error": "Acc√®s non autoris√©. Seul le propri√©taire peut retirer des participants."
}
```

```json
{
  "error": "Impossible de retirer le propri√©taire de l'√©v√©nement"
}
```

#### Lister les participants d'un √©v√©nement
```
GET /api/event/:eventId/participants
```

**R√©ponse :**
```json
{
  "event_id": 1,
  "participants": [
    {
      "user_id": 123,
      "role": "owner",
      "joined_at": "2024-01-15T10:00:00Z",
      "username": "proprietaire",
      "email": "proprio@example.com",
      "fname": "Pr√©nom",
      "lname": "Nom"
    },
    {
      "user_id": 456,
      "role": "participant",
      "joined_at": "2024-01-15T11:00:00Z",
      "username": "participant1",
      "email": "participant1@example.com",
      "fname": "Pr√©nom2",
      "lname": "Nom2"
    }
  ]
}
```

### Obtenir un √©v√©nement par ID
```
GET /api/event/:id
```

**R√©ponse :**
```json
{
  "id": 1,
  "title": "Titre de l'√©v√©nement",
  "description": "Description de l'√©v√©nement",
  "start_date": "2024-01-15T10:00:00Z",
  "end_date": "2024-01-15T18:00:00Z",
  "location": "Lieu de l'√©v√©nement",
  "owner_id": 123
}
```

### Obtenir les √©v√©nements par propri√©taire
```
GET /api/event/owner/:ownerId
```

**R√©ponse :**
```json
[
  {
    "id": 1,
    "title": "√âv√©nement 1",
    "description": "Description 1",
    "start_date": "2024-01-15T10:00:00Z",
    "end_date": "2024-01-15T18:00:00Z",
    "location": "Lieu 1",
    "owner_id": 123
  }
]
```

### Obtenir les √©v√©nements par participant
```
GET /api/event/participant/:participantId
```

**R√©ponse :**
```json
[
  {
    "id": 1,
    "title": "√âv√©nement 1",
    "description": "Description 1",
    "start_date": "2024-01-15T10:00:00Z",
    "end_date": "2024-01-15T18:00:00Z",
    "location": "Lieu 1",
    "owner_id": 123
  }
]
```

## ‚úÖ Contr√¥leur de Sant√© (`/api/health`)

### Health Check Public
```
GET /api/health
```

**R√©ponse :**
```json
{
  "success": true,
  "data": {
    "status": "healthy",
    "server": {
      "status": "operational",
      "timestamp": "2024-01-15T10:00:00.000Z",
      "uptime": 3600,
      "environment": "development",
      "version": "1.0.0"
    },
    "services": {
      "mongodb": {
        "status": "healthy",
        "state": "connected",
        "message": "MongoDB is connected and responding"
      },
      "mysql": {
        "status": "healthy",
        "message": "MySQL is connected and responding"
      }
    },
    "performance": {
      "responseTime": "45ms",
      "memory": {
        "used": "45MB",
        "total": "67MB"
      }
    }
  },
  "message": "API health check successful"
}
```

### Health Check Prot√©g√© (Authentifi√©)
```
GET /api/health/protected
Authorization: Bearer <token>
```

**R√©ponse :**
```json
{
  "success": true,
  "data": {
    "status": "healthy",
    "server": {
      "status": "operational",
      "timestamp": "2024-01-15T10:00:00.000Z",
      "uptime": 3600,
      "environment": "development",
      "version": "1.0.0"
    },
    "user": {
      "id": 123,
      "username": "testuser",
      "email": "testuser@example.com",
      "role": "user",
      "lastLogin": null
    },
    "services": {
      "mongodb": {
        "status": "healthy",
        "state": "connected",
        "message": "MongoDB is connected and responding"
      },
      "mysql": {
        "status": "healthy",
        "message": "MySQL is connected and responding"
      }
    },
    "performance": {
      "responseTime": "45ms",
      "memory": {
        "used": "45MB",
        "total": "67MB"
      }
    },
    "security": {
      "authenticated": true,
      "tokenValid": true,
      "userAuthorized": true
    }
  },
  "message": "Protected health check successful for user testuser"
}
```

## üìã Contr√¥leur de T√¢ches (`/api/task`)

### Cr√©er une t√¢che
```
POST /api/task/create
Authorization: Bearer <token>
Content-Type: application/json

{
  "title": "Titre de la t√¢che",
  "description": "Description de la t√¢che",
  "event_id": 1,
  "owner_id": 123
}
```

**R√©ponse :**
```json
{
  "id": 1,
  "title": "Titre de la t√¢che",
  "description": "Description de la t√¢che",
  "event_id": 1,
  "owner_id": 123
}
```

### Mettre √† jour une t√¢che
```
PUT /api/task/:id
Authorization: Bearer <token>
Content-Type: application/json

{
  "title": "Nouveau titre de la t√¢che",
  "description": "Nouvelle description de la t√¢che",
  "status": "in_progress",
  "priority": "high",
  "due_date": "2024-01-20T18:00:00Z",
  "assigned_to": 456
}
```

**Champs modifiables :**
- `title` : Titre de la t√¢che
- `description` : Description de la t√¢che
- `status` : Statut de la t√¢che
- `priority` : Priorit√© de la t√¢che
- `due_date` : Date d'√©ch√©ance
- `assigned_to` : Utilisateur assign√© √† la t√¢che

**R√©ponse :**
```json
{
  "message": "T√¢che mise √† jour avec succ√®s",
  "task": {
    "id": 1,
    "title": "Nouveau titre de la t√¢che",
    "description": "Nouvelle description de la t√¢che",
    "event_id": 1,
    "owner_id": 123,
    "status": "in_progress",
    "priority": "high",
    "due_date": "2024-01-20T18:00:00Z",
    "assigned_to": 456,
    "updated_at": "2024-01-15T16:30:00Z"
  }
}
```

**Erreurs possibles :**
```json
{
  "error": "T√¢che non trouv√©e"
}
```

```json
{
  "error": "Acc√®s non autoris√©. Seul le propri√©taire peut modifier cette t√¢che."
}
```

### Obtenir une t√¢che par ID
```
GET /api/task/:id
```

**R√©ponse :**
```json
{
  "id": 1,
  "title": "Titre de la t√¢che",
  "description": "Description de la t√¢che",
  "event_id": 1,
  "owner_id": 123
}
```

### Obtenir les t√¢ches par √©v√©nement
```
GET /api/task/event/:eventId
```

**R√©ponse :**
```json
[
  {
    "id": 1,
    "title": "T√¢che 1",
    "description": "Description 1",
    "event_id": 1,
    "owner_id": 123
  }
]
```

### Obtenir les t√¢ches par propri√©taire
```
GET /api/task/owner/:ownerId
```

**R√©ponse :**
```json
[
  {
    "id": 1,
    "title": "T√¢che 1",
    "description": "Description 1",
    "event_id": 1,
    "owner_id": 123
  }
]
```

### Obtenir les t√¢ches par participant
```
GET /api/task/participant/:participantId
```

**R√©ponse :**
```json
[
  {
    "id": 1,
    "title": "T√¢che 1",
    "description": "Description 1",
    "event_id": 1,
    "owner_id": 123
  }
]
```


Pour utiliser le nouveau syst√®me de codes de confirmation, ajoutez ces colonnes √† votre table `users` :

```sql
ALTER TABLE users 
ADD COLUMN confirmation_code VARCHAR(6) NULL,
ADD COLUMN confirmation_code_expires DATETIME NULL;

-- Index pour optimiser les performances (optionnel)
CREATE INDEX idx_users_confirmation_code ON users(confirmation_code, confirmation_code_expires);
```

## üì± Flux d'authentification pour React Native

1. **Inscription** : L'utilisateur s'inscrit ‚Üí re√ßoit un code √† 6 chiffres par email
2. **Confirmation** : L'utilisateur saisit le code dans l'app ‚Üí compte activ√©
3. **Connexion** : L'utilisateur peut se connecter normalement
4. **Renvoyer code** : Si le code expire, l'utilisateur peut en demander un nouveau

## üîó Routes API R√©sum√©

| M√©thode | Route | Description | Authentification |
|---------|-------|-------------|------------------|
| POST | `/api/auth/register` | Inscription utilisateur | Non |
| POST | `/api/auth/login` | Connexion utilisateur | Non |
| POST | `/api/auth/logout` | D√©connexion utilisateur | Oui |
| POST | `/api/auth/forgot-password` | Mot de passe oubli√© | Non |
| POST | `/api/auth/confirm` | Confirmation email | Non |
| POST | `/api/auth/resend-confirmation-email` | Renvoyer code | Non |
| POST | `/api/event/create` | Cr√©er √©v√©nement | Oui |
| PUT | `/api/event/:id` | Mettre √† jour √©v√©nement | Oui |
| DELETE | `/api/event/:id` | Supprimer √©v√©nement | Oui |
| GET | `/api/event/:id` | Obtenir √©v√©nement | Non |
| GET | `/api/event/owner/:ownerId` | √âv√©nements par propri√©taire | Non |
| GET | `/api/event/participant/:participantId` | √âv√©nements par participant | Non |
| POST | `/api/event/:eventId/participants` | Ajouter participant | Oui |
| DELETE | `/api/event/:eventId/participants/:userId` | Retirer participant | Oui |
| GET | `/api/event/:eventId/participants` | Lister participants | Non |
| GET | `/api/health` | Health check public | Non |
| GET | `/api/health/protected` | Health check prot√©g√© | Oui |
| POST | `/api/task/create` | Cr√©er t√¢che | Oui |
| PUT | `/api/task/:id` | Mettre √† jour t√¢che | Oui |
| GET | `/api/task/:id` | Obtenir t√¢che | Non |
| GET | `/api/task/event/:eventId` | T√¢ches par √©v√©nement | Non |
| GET | `/api/task/owner/:ownerId` | T√¢ches par propri√©taire | Non |
| GET | `/api/task/participant/:participantId` | T√¢ches par participant | Non |

