# Iven API Documentation

## üîê Contr√¥leur d'Authentification (`/api/auth`)

### Register
```
POST /api/auth/register
Content-Type: application/json

{
  "username": "testuser",
  "email": "testuser@example.com",
  "password": "password123",
  "fname": "Pr√©nom",
  "lname": "Nom"
}   
```

**R√©ponse :**
```json
{
  "message": "Inscription r√©ussie ! Un code de confirmation √† 6 chiffres a √©t√© envoy√© √† votre email.",
  "userId": 123
}
```

### Confirm Email (Code √† 6 chiffres)
```
POST /api/auth/confirm
Content-Type: application/json

{
  "email": "testuser@example.com",
  "code": "123456"
}
```

**R√©ponse succ√®s :**
```json
{
  "message": "Compte activ√© avec succ√®s",
  "email": "testuser@example.com",
  "token": "jwt_token_here",
  "user": {
    "id": 123,
    "username": "testuser",
    "email": "testuser@example.com",
    "active": 1
  }
}
```

**R√©ponse erreur :**
```json
{
  "message": "Code invalide ou expir√©",
  "error": "Le code de confirmation est incorrect ou a expir√©. Veuillez demander un nouveau code."
}
```

### Resend Confirmation Code
```
POST /api/auth/resend-confirmation-email
Content-Type: application/json

{
  "email": "testuser@example.com"
}
```

**R√©ponse :**
```json
{
  "message": "Nouveau code de confirmation envoy√© par email"
}
```

### Login
```
POST /api/auth/login                                
Content-Type: application/json

{
  "email": "testuser@example.com",
  "password": "password123"
}
```

**R√©ponse succ√®s :**
```json
{
  "message": "Connexion r√©ussie",
  "token": "jwt_token_here",
  "user": {
    "id": 123,
    "username": "testuser",
    "email": "testuser@example.com",
    "active": 1,
    "fname": "Pr√©nom",
    "lname": "Nom"
  }
}
```

**R√©ponse compte non activ√© :**
```json
{
  "message": "Votre compte n'est pas activ√©",
  "code": "not-activated",
  "user": {
    "username": "testuser",
    "fname": "Pr√©nom",
    "lname": "Nom",
    "email": "testuser@example.com",
    "active": 0
  }
}
```

### V√©rifier la connexion (Token JWT)
```
GET /api/auth/is-connected
Authorization: Bearer <token>
```

**R√©ponse token valide :**
```json
{
  "message": "Utilisateur connect√©",
  "isConnected": true,
  "user": {
    "id": 123,
    "username": "testuser",
    "email": "testuser@example.com",
    "active": 1,
    "fname": "Pr√©nom",
    "lname": "Nom"
  }
}
```

**R√©ponse token expir√© :**
```json
{
  "message": "Token expir√©",
  "isConnected": false
}
```

**R√©ponse token invalide :**
```json
{
  "message": "Token invalide",
  "isConnected": false
}
```

**R√©ponse sans token :**
```json
{
  "message": "Aucun token fourni",
  "isConnected": false
}
```

### Obtenir un utilisateur par ID
```
GET /api/auth/user/:id
```

**R√©ponse :**
```json
{
  "id": 123,
  "username": "testuser",
  "email": "testuser@example.com",
  "role": "user",
  "active": 1,
  "fname": "Pr√©nom",
  "lname": "Nom"
}
```

**Erreurs possibles :**
```json
{
  "message": "Erreur lors de la r√©cup√©ration de l'utilisateur"
}
```

### Forgot Password
```
POST /api/auth/forgot-password
Content-Type: application/json

{
  "email": "testuser@example.com"
}
```

**R√©ponse :**
```json
{
  "message": "Instructions de r√©initialisation envoy√©es par email"
}
```

### Logout
```
POST /api/auth/logout
Authorization: Bearer <token>
```

**R√©ponse :**
```json
{
  "message": "D√©connexion r√©ussie"
}
```

## üìÖ Contr√¥leur d'√âv√©nements (`/api/event`)

### Cr√©er un √©v√©nement
```
POST /api/event/create
Authorization: Bearer <token>
Content-Type: application/json

{
  "title": "Titre de l'√©v√©nement",
  "description": "Description de l'√©v√©nement",
  "start_date": "2024-01-15T10:00:00Z",
  "end_date": "2024-01-15T18:00:00Z",
  "location": "Lieu de l'√©v√©nement",
  "owner_id": 123
}
```

**R√©ponse :**
```json
{
  "id": 1,
  "title": "Titre de l'√©v√©nement",
  "description": "Description de l'√©v√©nement",
  "start_date": "2024-01-15T10:00:00Z",
  "end_date": "2024-01-15T18:00:00Z",
  "location": "Lieu de l'√©v√©nement",
  "owner_id": 123
}
```

### Mettre √† jour un √©v√©nement
```
PUT /api/event/:id
Authorization: Bearer <token>
Content-Type: application/json

{
  "title": "Nouveau titre de l'√©v√©nement",
  "description": "Nouvelle description de l'√©v√©nement",
  "start_date": "2024-01-16T10:00:00Z",
  "end_date": "2024-01-16T18:00:00Z",
  "location": "Nouveau lieu de l'√©v√©nement"
}
```

**R√©ponse :**
```json
{
  "message": "√âv√©nement mis √† jour avec succ√®s",
  "event": {
    "id": 1,
    "title": "Nouveau titre de l'√©v√©nement",
    "description": "Nouvelle description de l'√©v√©nement",
    "start_date": "2024-01-16T10:00:00Z",
    "end_date": "2024-01-16T18:00:00Z",
    "location": "Nouveau lieu de l'√©v√©nement",
    "owner_id": 123,
    "updated_at": "2024-01-15T15:30:00Z"
  }
}
```

**Erreurs possibles :**
```json
{
  "error": "√âv√©nement non trouv√©"
}
```

```json
{
  "error": "Acc√®s non autoris√©. Seul le propri√©taire peut modifier cet √©v√©nement."
}
```

### Supprimer un √©v√©nement
```
DELETE /api/event/:id
Authorization: Bearer <token>
```

**R√©ponse :**
```json
{
  "message": "√âv√©nement supprim√© avec succ√®s",
  "eventId": 1
}
```

**Erreurs possibles :**
```json
{
  "error": "√âv√©nement non trouv√©"
}
```

```json
{
  "error": "Acc√®s non autoris√©. Seul le propri√©taire peut supprimer cet √©v√©nement."
}
```

**‚ö†Ô∏è Attention :** La suppression d'un √©v√©nement supprime √©galement :
- Tous les participants de l'√©v√©nement
- Toutes les t√¢ches associ√©es √† l'√©v√©nement
- Toutes les d√©penses associ√©es √† l'√©v√©nement

### G√©rer les participants d'un √©v√©nement

> **‚ÑπÔ∏è Note importante :** L'ajout de participants se fait maintenant exclusivement via le syst√®me d'invitation. Les utilisateurs sont automatiquement ajout√©s comme participants lorsqu'ils acceptent une invitation.
> 
> **üîß Note technique :** La m√©thode `addParticipant` est toujours utilis√©e en interne par le syst√®me d'invitation, mais n'est plus accessible directement via l'API.

#### Retirer un participant
```
DELETE /api/event/:eventId/participants/:userId
Authorization: Bearer <token>
```

**R√©ponse :**
```json
{
  "message": "Participant retir√© avec succ√®s",
  "eventId": 1,
  "userId": 456
}
```

**Erreurs possibles :**
```json
{
  "error": "Acc√®s non autoris√©. Seul le propri√©taire peut retirer des participants."
}
```

```json
{
  "error": "Impossible de retirer le propri√©taire de l'√©v√©nement"
}
```

#### Lister les participants d'un √©v√©nement
```
GET /api/event/:eventId/participants
```

**R√©ponse :**
```json
{
  "event_id": 1,
  "participants": [
    {
      "user_id": 123,
      "role": "owner",
      "created_at": "2024-01-15T10:00:00.000Z",
      "username": "proprietaire",
      "fname": "Pr√©nom",
      "lname": "Nom"
    },
    {
      "user_id": 456,
      "role": "participant",
      "created_at": "2024-01-15T11:00:00.000Z",
      "username": "participant1",
      "fname": "Pr√©nom2",
      "lname": "Nom2"
    }
  ]
}
```

**Erreurs possibles :**
```json
{
  "error": "√âv√©nement non trouv√©"
}
```

### **Gestion des invitations d'√©v√©nements**

> **üîÑ Workflow d'invitation :** 
> 1. **Recherche** : Le propri√©taire recherche des utilisateurs via `search-users`
> 2. **Invitation** : Il envoie une invitation avec un message personnalis√©
> 3. **Notification** : L'utilisateur invit√© re√ßoit l'invitation
> 4. **R√©ponse** : L'utilisateur accepte ou d√©cline l'invitation
> 5. **Int√©gration** : Si accept√©e, l'utilisateur devient automatiquement participant

#### Inviter un utilisateur √† un √©v√©nement
```
POST /api/event/:eventId/invite
Authorization: Bearer <token>
Content-Type: application/json

{
  "userId": 456,
  "message": "Voulez-vous participer √† notre √©v√©nement ?"
}
```

**R√©ponse :**
```json
{
  "message": "Invitation envoy√©e avec succ√®s",
  "invitation": {
    "id": 1,
    "event_id": 1,
    "invited_user": {
      "id": 456,
      "username": "nouveau_user",
      "email": "nouveau@example.com",
      "fname": "Pr√©nom",
      "lname": "Nom"
    },
    "message": "Voulez-vous participer √† notre √©v√©nement ?",
    "expires_at": "2024-01-22T10:00:00.000Z"
  }
}
```

**Erreurs possibles :**
```json
{
  "error": "Acc√®s non autoris√©. Seul le propri√©taire peut inviter des utilisateurs."
}
```

```json
{
  "error": "Cet utilisateur est d√©j√† participant de cet √©v√©nement"
}
```

```json
{
  "error": "Cet utilisateur est d√©j√† invit√© √† cet √©v√©nement"
}
```

#### Voir les invitations d'un √©v√©nement
```
GET /api/event/:eventId/invitations
Authorization: Bearer <token>
```

**R√©ponse :**
```json
{
  "event_id": 1,
  "invitations": [
    {
      "id": 1,
      "event_id": 1,
      "invited_user_id": 456,
      "invited_by": 123,
      "status": "pending",
      "message": "Voulez-vous participer √† notre √©v√©nement ?",
      "expires_at": "2024-01-22T10:00:00.000Z",
      "created_at": "2024-01-15T10:00:00.000Z",
      "invited_username": "nouveau_user",
      "invited_fname": "Pr√©nom",
      "invited_lname": "Nom",
      "invited_email": "nouveau@example.com"
    }
  ]
}
```

#### Voir ses propres invitations
```
GET /api/event/invitations/user
Authorization: Bearer <token>
```

**R√©ponse :**
```json
{
  "user_id": 456,
  "invitations": [
    {
      "id": 1,
      "event_id": 1,
      "invited_user_id": 456,
      "invited_by": 123,
      "status": "pending",
      "message": "Voulez-vous participer √† notre √©v√©nement ?",
      "expires_at": "2024-01-22T10:00:00.000Z",
      "created_at": "2024-01-15T10:00:00.000Z",
      "event_title": "Titre de l'√©v√©nement",
      "event_description": "Description de l'√©v√©nement",
      "start_date": "2024-01-15T10:00:00.000Z",
      "end_date": "2024-01-15T18:00:00.000Z",
      "location": "Lieu de l'√©v√©nement",
      "inviter_username": "proprietaire",
      "inviter_fname": "Pr√©nom",
      "inviter_lname": "Nom"
    }
  ]
}
```

#### R√©pondre √† une invitation
```
PUT /api/event/invitations/:invitationId/respond
Authorization: Bearer <token>
Content-Type: application/json

{
  "response": "accepted"
}
```

**R√©ponse pour acceptation :**
```json
{
  "message": "Invitation accept√©e. Vous √™tes maintenant participant de l'√©v√©nement.",
  "event": {
    "id": 1,
    "title": "Titre de l'√©v√©nement",
    "start_date": "2024-01-15T10:00:00.000Z",
    "end_date": "2024-01-15T18:00:00.000Z",
    "location": "Lieu de l'√©v√©nement"
  }
}
```

**R√©ponse pour d√©clin :**
```json
{
  "message": "Invitation d√©clin√©e.",
  "invitation_id": 1
}
```

**Erreurs possibles :**
```json
{
  "error": "R√©ponse invalide. Utilisez \"accepted\" ou \"declined\"."
}
```

```json
{
  "error": "Cette invitation a d√©j√† √©t√© trait√©e ou a expir√©."
}
```

#### Annuler une invitation
```
DELETE /api/event/invitations/:invitationId
Authorization: Bearer <token>
```

**R√©ponse :**
```json
{
  "message": "Invitation annul√©e avec succ√®s",
  "invitation_id": 1
}
```

**Erreurs possibles :**
```json
{
  "error": "Acc√®s non autoris√©. Seul le propri√©taire peut annuler une invitation."
}
```

#### **Rechercher des utilisateurs**
```
GET /api/event/search/users?q=john&eventId=1&excludeParticipants=true
Authorization: Bearer <token>
```

**Param√®tres de requ√™te :**
- `q` : Terme de recherche (obligatoire, minimum 2 caract√®res)
- `eventId` : ID de l'√©v√©nement pour exclure les participants existants (optionnel)
- `excludeParticipants` : Exclure les participants existants (d√©faut: true)

**R√©ponse :**
```json
{
  "success": true,
  "data": {
    "users": [
      {
        "id": 789,
        "username": "john_doe",
        "email": "john@example.com",
        "role": "user",
        "fname": "John",
        "lname": "Doe"
      }
    ],
    "count": 1,
    "searchTerm": "john"
  },
  "message": "1 utilisateur(s) trouv√©(s)"
}
```

**Erreurs possibles :**
```json
{
  "error": "Le terme de recherche doit contenir au moins 2 caract√®res."
}
```

### Obtenir un √©v√©nement par ID
```
GET /api/event/:id
```

**R√©ponse :**
```json
{
  "id": 1,
  "title": "Titre de l'√©v√©nement",
  "description": "Description de l'√©v√©nement",
  "start_date": "2024-01-15T10:00:00Z",
  "end_date": "2024-01-15T18:00:00Z",
  "location": "Lieu de l'√©v√©nement",
  "owner_id": 123
}
```

### Obtenir les √©v√©nements par propri√©taire
```
GET /api/event/owner/:ownerId
```

**R√©ponse :**
```json
[
  {
    "id": 1,
    "title": "√âv√©nement 1",
    "description": "Description 1",
    "start_date": "2024-01-15T10:00:00Z",
    "end_date": "2024-01-15T18:00:00Z",
    "location": "Lieu 1",
    "owner_id": 123
  }
]
```

### Obtenir les √©v√©nements par participant
```
GET /api/event/participant/:participantId
```

**R√©ponse :**
```json
[
  {
    "id": 4,
    "owner_id": 3,
    "title": "R√©union √©quipe",
    "description": "R√©union hebdomadaire",
    "start_date": "2024-01-15T09:00:00.000Z",
    "end_date": "2024-01-15T10:30:00.000Z",
    "location": "Salle de r√©union",
    "created_at": "2025-08-21T16:06:05.000Z",
    "updated_at": "2025-08-21T16:06:05.000Z",
    "participants": [
      {
        "user_id": 3,
        "role": "owner",
        "created_at": "2025-08-21T16:06:05.000Z",
        "username": "arthurjfr",
        "fname": "Arthur",
        "lname": "Jaffro "
      }
    ],
    "tasks": [
      {
        "id": 2,
        "owner_id": 3,
        "event_id": 4,
        "title": "acheter pain",
        "description": "acheter pain avant bbq",
        "validated_by": null,
        "created_at": "2025-08-21T16:06:24.000Z",
        "updated_at": "2025-08-21T16:06:24.000Z",
        "owner_username": "arthurjfr",
        "owner_fname": "Arthur",
        "owner_lname": "Jaffro "
      }
    ]
  }
]
```

**Description :**
Cette route retourne tous les √©v√©nements o√π l'utilisateur sp√©cifi√© est participant (soit comme propri√©taire, soit comme participant ajout√©). Chaque √©v√©nement inclut :
- **Informations de base** : id, titre, description, dates, lieu, propri√©taire
- **Participants** : Liste compl√®te des participants avec leurs r√¥les et informations
- **T√¢ches** : Toutes les t√¢ches associ√©es √† l'√©v√©nement avec leurs d√©tails

## ‚úÖ Contr√¥leur de Sant√© (`/api/health`)

### Health Check Public
```
GET /api/health
```

**R√©ponse :**
```json
{
  "success": true,
  "data": {
    "status": "healthy",
    "server": {
      "status": "operational",
      "timestamp": "2024-01-15T10:00:00.000Z",
      "uptime": 3600,
      "environment": "development",
      "version": "1.0.0"
    },
    "services": {
      "mongodb": {
        "status": "healthy",
        "state": "connected",
        "message": "MongoDB is connected and responding"
      },
      "mysql": {
        "status": "healthy",
        "message": "MySQL is connected and responding"
      }
    },
    "performance": {
      "responseTime": "45ms",
      "memory": {
        "used": "45MB",
        "total": "67MB"
      }
    }
  },
  "message": "API health check successful"
}
```

### Health Check Prot√©g√© (Authentifi√©)
```
GET /api/health/protected
Authorization: Bearer <token>
```

**R√©ponse :**
```json
{
  "success": true,
  "data": {
    "status": "healthy",
    "server": {
      "status": "operational",
      "timestamp": "2024-01-15T10:00:00.000Z",
      "uptime": 3600,
      "environment": "development",
      "version": "1.0.0"
    },
    "user": {
      "id": 123,
      "username": "testuser",
      "email": "testuser@example.com",
      "role": "user",
      "lastLogin": null
    },
    "services": {
      "mongodb": {
        "status": "healthy",
        "state": "connected",
        "message": "MongoDB is connected and responding"
      },
      "mysql": {
        "status": "healthy",
        "message": "MySQL is connected and responding"
      }
    },
    "performance": {
      "responseTime": "45ms",
      "memory": {
        "used": "45MB",
        "total": "67MB"
      }
    },
    "security": {
      "authenticated": true,
      "tokenValid": true,
      "userAuthorized": true
    }
  },
  "message": "Protected health check successful for user testuser"
}
```

## üìã Contr√¥leur de T√¢ches (`/api/task`)

### Cr√©er une t√¢che
```
POST /api/task/create
Authorization: Bearer <token>
Content-Type: application/json

{
  "title": "Titre de la t√¢che",
  "description": "Description de la t√¢che",
  "event_id": 1,
  "owner_id": 123
}
```

**R√©ponse :**
```json
{
  "id": 1,
  "title": "Titre de la t√¢che",
  "description": "Description de la t√¢che",
  "event_id": 1,
  "owner_id": 123
}
```

### Mettre √† jour une t√¢che
```
PUT /api/task/:id
Authorization: Bearer <token>
Content-Type: application/json

{
  "title": "Nouveau titre de la t√¢che",
  "description": "Nouvelle description de la t√¢che"
}
```

**Champs modifiables :**
- `title` : Titre de la t√¢che
- `description` : Description de la t√¢che

**R√©ponse :**
```json
{
  "message": "T√¢che mise √† jour avec succ√®s",
  "task": {
    "id": 1,
    "title": "Nouveau titre de la t√¢che",
    "description": "Nouvelle description de la t√¢che",
    "event_id": 1,
    "owner_id": 123,
    "validated_by": null,
    "created_at": "2024-01-15T10:00:00.000Z",
    "updated_at": "2024-01-15T16:30:00.000Z"
  }
}
```

**Erreurs possibles :**
```json
{
  "error": "T√¢che non trouv√©e"
}
```

```json
{
  "error": "Acc√®s non autoris√©. Seul le propri√©taire peut modifier cette t√¢che."
}
```

### Obtenir une t√¢che par ID
```
GET /api/task/:id
```

**R√©ponse :**
```json
{
  "id": 1,
  "title": "Titre de la t√¢che",
  "description": "Description de la t√¢che",
  "event_id": 1,
  "owner_id": 123,
  "validated_by": null,
  "created_at": "2024-01-15T10:00:00.000Z",
  "updated_at": "2024-01-15T10:00:00.000Z"
}
```

### Obtenir les t√¢ches par √©v√©nement
```
GET /api/task/event/:eventId
```

**R√©ponse :**
```json
[
  {
    "id": 1,
    "title": "T√¢che 1",
    "description": "Description 1",
    "event_id": 1,
    "owner_id": 123,
    "validated_by": null,
    "created_at": "2024-01-15T10:00:00.000Z",
    "updated_at": "2024-01-15T10:00:00.000Z"
  }
]
```

### Obtenir les t√¢ches par propri√©taire
```
GET /api/task/owner/:ownerId
```

**R√©ponse :**
```json
[
  {
    "id": 1,
    "title": "T√¢che 1",
    "description": "Description 1",
    "event_id": 1,
    "owner_id": 123,
    "validated_by": null,
    "created_at": "2024-01-15T10:00:00.000Z",
    "updated_at": "2024-01-15T10:00:00.000Z"
  }
]
```

### Obtenir les t√¢ches par participant
```
GET /api/task/participant/:participantId
```

**R√©ponse :**
```json
[
  {
    "id": 1,
    "title": "T√¢che 1",
    "description": "Description 1",
    "event_id": 1,
    "owner_id": 123,
    "validated_by": null,
    "created_at": "2024-01-15T10:00:00.000Z",
    "updated_at": "2024-01-15T10:00:00.000Z"
  }
]
```

### **Valider une t√¢che**
```
POST /api/task/:id/validate
Authorization: Bearer <token>
```

**Description :** Permet √† un utilisateur de valider une t√¢che cr√©√©e par un autre utilisateur.

**R√®gles de validation :**
- Seuls les utilisateurs connect√©s peuvent valider des t√¢ches
- Un propri√©taire ne peut pas valider sa propre t√¢che
- Une t√¢che ne peut √™tre valid√©e qu'une seule fois

**R√©ponse succ√®s :**
```json
{
  "success": true,
  "message": "T√¢che valid√©e avec succ√®s",
  "task": {
    "id": 1,
    "title": "T√¢che valid√©e",
    "description": "Description de la t√¢che",
    "event_id": 1,
    "owner_id": 123,
    "validated_by": 456,
    "created_at": "2024-01-15T10:00:00.000Z",
    "updated_at": "2024-01-15T16:30:00.000Z"
  }
}
```

**Erreurs possibles :**
```json
{
  "success": false,
  "error": "T√¢che non trouv√©e"
}
```

```json
{
  "success": false,
  "error": "Vous ne pouvez pas valider votre propre t√¢che"
}
```

```json
{
  "success": false,
  "error": "Cette t√¢che est d√©j√† valid√©e"
}
```

### **Annuler la validation d'une t√¢che**
```
DELETE /api/task/:id/validate
Authorization: Bearer <token>
```

**Description :** Permet au validateur d'annuler sa validation d'une t√¢che.

**R√®gles :**
- Seul le validateur peut annuler sa validation
- N√©cessite une authentification

**R√©ponse succ√®s :**
```json
{
  "success": true,
  "message": "Validation de la t√¢che annul√©e",
  "task": {
    "id": 1,
    "title": "T√¢che",
    "description": "Description de la t√¢che",
    "event_id": 1,
    "owner_id": 123,
    "validated_by": null,
    "created_at": "2024-01-15T10:00:00.000Z",
    "updated_at": "2024-01-15T16:30:00.000Z"
  }
}
```

**Erreurs possibles :**
```json
{
  "success": false,
  "error": "T√¢che non trouv√©e"
}
```

```json
{
  "success": false,
  "error": "Seul le validateur peut annuler sa validation"
}
```

### **Obtenir les t√¢ches valid√©es par un utilisateur**
```
GET /api/task/validated-by/:userId
```

**Description :** R√©cup√®re toutes les t√¢ches valid√©es par un utilisateur sp√©cifique.

**R√©ponse :**
```json
{
  "success": true,
  "data": {
    "tasks": [
      {
        "id": 1,
        "title": "T√¢che valid√©e 1",
        "description": "Description 1",
        "event_id": 1,
        "owner_id": 123,
        "validated_by": 456,
        "created_at": "2024-01-15T10:00:00.000Z",
        "updated_at": "2024-01-15T16:30:00.000Z"
      },
      {
        "id": 2,
        "title": "T√¢che valid√©e 2",
        "description": "Description 2",
        "event_id": 2,
        "owner_id": 789,
        "validated_by": 456,
        "created_at": "2024-01-15T11:00:00.000Z",
        "updated_at": "2024-01-15T17:00:00.000Z"
      }
    ],
    "count": 2
  },
  "message": "2 t√¢ches valid√©es trouv√©es"
}
```

---

## üìä Contr√¥leur de Logs (`/api/log`)

### Obtenir les logs r√©cents
```
GET /api/log/recent?level=error&limit=50&page=1&days=7&userId=123&search=erreur
```

**Param√®tres de requ√™te :**
- `level` : Niveau de log (error, warn, info, http, verbose, debug, silly)
- `limit` : Nombre de logs par page (d√©faut: 50)
- `page` : Num√©ro de page (d√©faut: 1)
- `days` : Nombre de jours √† remonter (d√©faut: 7)
- `userId` : Filtrer par utilisateur sp√©cifique
- `search` : Recherche textuelle dans le message, m√©thode ou URL

**R√©ponse :**
```json
{
  "success": true,
  "data": {
    "logs": [
      {
        "_id": "log_id",
        "level": "error",
        "message": "Erreur de connexion √† la base de donn√©es",
        "timestamp": "2024-01-15T10:00:00.000Z",
        "userId": {
          "_id": 123,
          "username": "testuser",
          "email": "testuser@example.com",
          "fname": "Pr√©nom",
          "lname": "Nom"
        },
        "meta": {
          "method": "POST",
          "url": "/api/auth/login",
          "ip": "192.168.1.1"
        }
      }
    ],
    "pagination": {
      "currentPage": 1,
      "totalPages": 5,
      "totalItems": 250,
      "itemsPerPage": 50,
      "hasNextPage": true,
      "hasPrevPage": false
    }
  },
  "message": "50 logs r√©cup√©r√©s sur 250"
}
```

### Obtenir les statistiques des logs
```
GET /api/log/stats?days=7
```

**Param√®tres de requ√™te :**
- `days` : Nombre de jours pour les statistiques (d√©faut: 7)

**R√©ponse :**
```json
{
  "success": true,
  "data": {
    "period": "7 jours",
    "totalLogs": 1250,
    "levelCounts": {
      "error": 45,
      "warn": 120,
      "info": 850,
      "http": 235
    },
    "dailyStats": [
      {
        "_id": {
          "date": "2024-01-15",
          "level": "error"
        },
        "count": 7
      }
    ]
  },
  "message": "Statistiques des logs r√©cup√©r√©es avec succ√®s"
}
```

### Obtenir les logs d'erreur
```
GET /api/log/errors?limit=20&page=1
```

**Param√®tres de requ√™te :**
- `limit` : Nombre de logs par page (d√©faut: 20)
- `page` : Num√©ro de page (d√©faut: 1)

**R√©ponse :**
```json
{
  "success": true,
  "data": {
    "logs": [
      {
        "_id": "log_id",
        "level": "error",
        "message": "Erreur de validation des donn√©es",
        "timestamp": "2024-01-15T10:00:00.000Z",
        "userId": {
          "_id": 123,
          "username": "testuser",
          "email": "testuser@example.com",
          "fname": "Pr√©nom",
          "lname": "Nom"
        },
        "meta": {
          "method": "POST",
          "url": "/api/event/create",
          "ip": "192.168.1.1"
        }
      }
    ],
    "pagination": {
      "currentPage": 1,
      "totalPages": 3,
      "totalItems": 45,
      "itemsPerPage": 20
    }
  },
  "message": "20 logs d'erreur r√©cup√©r√©s"
}
```

### Obtenir les logs d'un utilisateur sp√©cifique
```
GET /api/log/user/:userId?limit=50&page=1&level=error
```

**Param√®tres de requ√™te :**
- `limit` : Nombre de logs par page (d√©faut: 50)
- `page` : Num√©ro de page (d√©faut: 1)
- `level` : Filtrer par niveau de log (optionnel)

**R√©ponse :**
```json
{
  "success": true,
  "data": {
    "logs": [
      {
        "_id": "log_id",
        "level": "info",
        "message": "Connexion utilisateur r√©ussie",
        "timestamp": "2024-01-15T10:00:00.000Z",
        "userId": {
          "_id": 123,
          "username": "testuser",
          "email": "testuser@example.com",
          "fname": "Pr√©nom",
          "lname": "Nom"
        },
        "meta": {
          "method": "POST",
          "url": "/api/auth/login",
          "ip": "192.168.1.1"
        }
      }
    ],
    "pagination": {
      "currentPage": 1,
      "totalPages": 2,
      "totalItems": 75,
      "itemsPerPage": 50
    }
  },
  "message": "50 logs utilisateur r√©cup√©r√©s"
}
```

### Nettoyer les anciens logs (Admin)
```
DELETE /api/log/clean?days=30
Authorization: Bearer <token>
```

**Param√®tres de requ√™te :**
- `days` : Nombre de jours √† conserver (d√©faut: 30)

**R√©ponse :**
```json
{
  "success": true,
  "data": {
    "deletedCount": 1250,
    "daysKept": 30
  },
  "message": "1250 anciens logs supprim√©s (conserv√©s: 30 jours)"
}
```

**‚ö†Ô∏è Attention :** Cette op√©ration est irr√©versible et supprime d√©finitivement les logs plus anciens que le nombre de jours sp√©cifi√©.

Pour utiliser le nouveau syst√®me de codes de confirmation, ajoutez ces colonnes √† votre table `users` :

```sql
ALTER TABLE users 
ADD COLUMN confirmation_code VARCHAR(6) NULL,
ADD COLUMN confirmation_code_expires DATETIME NULL;

-- Index pour optimiser les performances (optionnel)
CREATE INDEX idx_users_confirmation_code ON users(confirmation_code, confirmation_code_expires);
```

## üì± Flux d'authentification pour React Native

1. **Inscription** : L'utilisateur s'inscrit ‚Üí re√ßoit un code √† 6 chiffres par email
2. **Confirmation** : L'utilisateur saisit le code dans l'app ‚Üí compte activ√©
3. **Connexion** : L'utilisateur peut se connecter normalement
4. **V√©rification connexion** : √Ä l'ouverture de l'app, v√©rifier si le token est encore valide
5. **Renvoyer code** : Si le code expire, l'utilisateur peut en demander un nouveau

### Gestion de la persistance de session

La m√©thode `is-connected` permet de :
- **V√©rifier automatiquement** si l'utilisateur est toujours connect√© lors de la r√©ouverture de l'app
- **G√©rer les tokens expir√©s** en redirigeant vers la page de connexion
- **Maintenir l'exp√©rience utilisateur** en √©vitant de demander les identifiants √† chaque fois
- **Retourner les informations utilisateur** si la session est valide

**Utilisation recommand√©e :**
- Appeler cette m√©thode au d√©marrage de l'application
- Stocker le token JWT localement (AsyncStorage/SecureStore)
- Si `isConnected: false`, rediriger vers la page de connexion
- Si `isConnected: true`, rediriger vers l'√©cran principal avec les donn√©es utilisateur

## üîó Routes API R√©sum√©

| M√©thode | Route | Description | Authentification |
|---------|-------|-------------|------------------|
| POST | `/api/auth/register` | Inscription utilisateur | Non |
| POST | `/api/auth/login` | Connexion utilisateur | Non |
| GET | `/api/auth/is-connected` | V√©rifier statut connexion | Non (mais token requis) |
| GET | `/api/auth/user/:id` | Obtenir utilisateur par ID | Non |
| POST | `/api/auth/logout` | D√©connexion utilisateur | Oui |
| POST | `/api/auth/forgot-password` | Mot de passe oubli√© | Non |
| POST | `/api/auth/confirm` | Confirmation email | Non |
| POST | `/api/auth/resend-confirmation-email` | Renvoyer code | Non |
| POST | `/api/event/create` | Cr√©er √©v√©nement | Oui |
| PUT | `/api/event/:id` | Mettre √† jour √©v√©nement | Oui |
| DELETE | `/api/event/:id` | Supprimer √©v√©nement | Oui |
| GET | `/api/event/:id` | Obtenir √©v√©nement | Non |
| GET | `/api/event/owner/:ownerId` | √âv√©nements par propri√©taire | Non |
| GET | `/api/event/participant/:participantId` | √âv√©nements par participant | Non |
| DELETE | `/api/event/:eventId/participants/:userId` | Retirer participant | Oui |
| GET | `/api/event/:eventId/participants` | Lister participants | Non |
| POST | `/api/event/:eventId/invite` | Inviter utilisateur | Oui |
| GET | `/api/event/:eventId/invitations` | Voir invitations √©v√©nement | Oui |
| GET | `/api/event/invitations/user` | Voir ses propres invitations | Oui |
| PUT | `/api/event/invitations/:invitationId/respond` | R√©pondre √† invitation | Oui |
| DELETE | `/api/event/invitations/:invitationId` | Annuler invitation | Oui |
| GET | `/api/event/search/users` | Rechercher utilisateurs | Oui |
| GET | `/api/health` | Health check public | Non |
| GET | `/api/health/protected` | Health check prot√©g√© | Oui |
| POST | `/api/task/create` | Cr√©er t√¢che | Oui |
| PUT | `/api/task/:id` | Mettre √† jour t√¢che | Oui |
| GET | `/api/task/:id` | Obtenir t√¢che | Non |
| GET | `/api/task/event/:eventId` | T√¢ches par √©v√©nement | Non |
| GET | `/api/task/owner/:ownerId` | T√¢ches par propri√©taire | Non |
| GET | `/api/task/participant/:participantId` | T√¢ches par participant | Non |
| POST | `/api/task/:id/validate` | Valider une t√¢che | Oui | User+ |
| DELETE | `/api/task/:id/validate` | Annuler validation | Oui | User+ |
| GET | `/api/task/validated-by/:userId` | T√¢ches valid√©es par un utilisateur | Non | - |
| GET | `/api/log/recent` | Logs r√©cents avec filtres | Non |
| GET | `/api/log/stats` | Statistiques des logs | Non |
| GET | `/api/log/errors` | Logs d'erreur | Non |
| GET | `/api/log/user/:userId` | Logs par utilisateur | Non |
| DELETE | `/api/log/clean` | Nettoyer anciens logs | Oui |
| DELETE | `/api/log/clean-all` | Supprimer tous les logs | Oui | Superadmin |

---


